<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Iniciar Sesión</title>
    <!-- Agrega el enlace a Bootstrap CDN para usar estilos y componentes de Bootstrap -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <h1 style="text-align: center; margin-top: -10%; margin-bottom: 5%;" id="tituloVentana">Iniciar Sesión</h1>
</head>
<style>
.btn {
    border: 1px solid #ccc;
}
</style>
<body class="container mt-5">

    <div class="form-group">

        <label style=" margin-bottom: 10%;"  for="correo">Correo / Telefono:</label>
        <input type="text" class="form-control" id="correo" placeholder="Ingrese su correo/telefono" style="max-height: 300px; max-width: 300px;margin-top: -10%;">
    </div>
    <div class="form-group">
        <label style="margin-top: -10%;" for="contrasena">Contraseña:</label>
        <input type="password" class="form-control" id="contrasena" placeholder="Ingrese su contraseña" style="max-height: 300px; max-width: 300px; margin-bottom: 10%;">
    </div>
    <select class="form-select" id="rol" name="rol" style="margin-bottom: 10%; margin-top: -5%;max-height: 300px; max-width: 300px"onchange="habilitarBotones()">
        <option value="" disabled selected hidden>Tipo de Cuenta</option>
        <option   value="cliente">Cliente</option>
        <option value="vendedor">Vendedor</option>
    </select>

    <button id="btnIniciarSesion" style="width: auto; height: 44px; margin-top: 0%;" class="btn btn-primary" onclick="IniciarSesion()">Iniciar Sesión</button>

    <button id="btnCrearCuenta" style="width: auto; height: 44px; margin-top: 0%;" class="btn btn-primary d-none" onclick="CrearCuenta()">
        Crear Cuenta
    </button>
    

    <button id="btnIniciarGoogle" class="btn btn-danger" onclick="iniciarSesionGoogle('iniciarSesionGoogle')">
        <img src="http://localhost/Proyecto_Bases_de__Datos/Templates/img/icons8-google.svg" style="max-height: 30px; max-width: 30px; margin-top: 0%;" alt="Google Icon" class="mr-2"> Iniciar con Google
    </button>

    <button id="btnCrearCuentaGoogle" class="btn btn-danger d-none" onclick="alternarBotonGoogle('crearCuentaGoogle')">
        <img src="http://localhost/Proyecto_Bases_de__Datos/Templates/img/icons8-google.svg" style="max-height: 30px; max-width: 30px; margin-top: 0%;" alt="Google Icon" class="mr-2"> Crear cuenta 
    </button>

    <p class="mt-3" id="mensajeCuenta">¿No tienes cuenta? <a href="#" onclick="CrearCuentaGoogle()">Crear cuenta</a></p>

    <!-- Agrega el enlace a Bootstrap JS y Popper.js para el soporte de JavaScript de Bootstrap -->
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      
        function habilitarBotones() {
            var comboBox = document.getElementById('rol');
            var btnCrearCuenta = document.getElementById("btnCrearCuenta");
            var btnCrearCuentaGoogle = document.getElementById("btnCrearCuentaGoogle");

            // Verifica si el combo box tiene una opción seleccionada
            if (comboBox.value !== "") {
                // Habilita los botones
                btnCrearCuenta.disabled = false;
                btnCrearCuentaGoogle.disabled = false;
            } else {
                // Deshabilita los botones si no hay una opción seleccionada
                btnCrearCuenta.disabled = true;
                btnCrearCuentaGoogle.disabled = true;
            }
        }
        function alternarBoton() {
            var btnIniciarSesion = document.getElementById("btnIniciarSesion");
            var btnCrearCuenta = document.getElementById("btnCrearCuenta");
            var comboBox = document.getElementById("rol");

            btnIniciarSesion.classList.toggle("d-none");
            btnCrearCuenta.classList.toggle("d-none");
            comboBox.classList.toggle("d-none");

            var tituloVentana = document.getElementById("tituloVentana").innerText;

            document.getElementById("tituloVentana").innerText = (btnIniciarSesion.classList.contains("d-none")) ? "Crear Cuenta" : "Iniciar Sesión";

            document.getElementById("mensajeCuenta").innerHTML = (btnIniciarSesion.classList.contains("d-none")) ? "¿Tienes una cuenta? <a href='#' onclick='alternarBoton()'>Iniciar Sesión</a>" : "¿No tienes cuenta? <a href='#' onclick='alternarBoton()'>Crear cuenta</a>";
            habilitarBotones();
            alternarBotonGoogle();
        }

        function alternarBotonGoogle(accion) {
            // Obtiene el botón de "Iniciar Sesión con Google"
            var btnIniciarGoogle = document.getElementById("btnIniciarGoogle");

            // Obtiene el botón de "Crear cuenta con Google"
            var btnCrearCuentaGoogle = document.getElementById("btnCrearCuentaGoogle");

            // Obtiene el botón de "Iniciar Sesión"
            var btnIniciarSesion = document.getElementById("btnIniciarSesion");

            // Obtiene el botón de "Crear Cuenta"
            var btnCrearCuenta = document.getElementById("btnCrearCuenta");

            // Alterna la visibilidad de los botones
            btnIniciarGoogle.classList.toggle("d-none");
            btnCrearCuentaGoogle.classList.toggle("d-none");

            // Lógica adicional según la acción
            if (accion === 'iniciarSesionGoogle') {
                // Oculta el botón "Crear Cuenta" si está visible
                if (!btnCrearCuenta.classList.contains("d-none")) {
                    btnCrearCuenta.classList.add("d-none");
                }
                // Muestra el botón "Iniciar Sesión"
                btnIniciarSesion.classList.remove("d-none");
                
                // Agrega aquí la lógica para iniciar sesión con Google
            } else if (accion === 'crearCuentaGoogle') {
                // Oculta el botón "Iniciar Sesión" si está visible
                if (!btnIniciarSesion.classList.contains("d-none")) {
                    btnIniciarSesion.classList.add("d-none");
                }
                // Muestra el botón "Crear Cuenta"
                btnCrearCuenta.classList.remove("d-none");
                
                // Agrega aquí la lógica para crear cuenta con Google
                habilitarBotones();
            }
        }  habilitarBotones();

        function IniciarSesion(){
           
            var correo = document.getElementById('correo').value;
            var contrasena = document.getElementById('contrasena').value;

            if(correo === null || contrasena === null )
            {
                prompt("Vacio");
            }else{
                //Realiza una solicitud fetch para enviar los datos a Consultas.php
                fetch('Consultas.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    body: 'correo=' + correo + '&contrasena=' + contrasena
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data); // Maneja la respuesta del servidor
                    if(data['mensaje'] === "Inicio de sesión exitoso"){
                        var enlaceEspecifico = 'Interfaz_Central.html';

                                // Accede a la ventana principal desde la ventana secundaria
                        var ventanaPrincipal = window.opener;

                    // Cambia la ubicación de la ventana principal
                    if (ventanaPrincipal) {
                        ventanaPrincipal.location.href = enlaceEspecifico;
                        // Cierra la ventana secundaria (ventana de inicio de sesión)
                        window.close();
                    } else {
                        // Si window.opener es nulo, puedes abrir una nueva ventana si es necesario
                        window.open(enlaceEspecifico, '_blank');
                    }
                    }
                    // Aquí puedes realizar acciones dependiendo de la respuesta del servidor
                })
                .catch(error => console.error('Error al realizar la solicitud:', error));
            }
        }

        function iniciarSesionGoogle() {
            var enlaceEspecifico = '/Templates/Interfaz_Central.html';

            // Accede a la ventana principal desde la ventana secundaria
            var ventanaPrincipal = window.opener;

            // Cambia la ubicación de la ventana principal
            if (ventanaPrincipal) {
                ventanaPrincipal.location.href = enlaceEspecifico;
                // Cierra la ventana secundaria (ventana de inicio de sesión)
                window.close();
            } else {
                // Si window.opener es nulo, puedes abrir una nueva ventana si es necesario
                window.open(enlaceEspecifico, '_blank');
            }
        }
        function CrearCuentaGoogle(){

        }
        function CrearCuenta() {
            var comboBox = document.getElementById('rol');
            var correo = document.getElementById('correo').value;
            var contrasena = document.getElementById('contrasena').value;

            if (correo === null || contrasena === null) {
                // Puedes manejar el caso de campos nulos aquí si es necesario
            } else {
                // Obtén el valor seleccionado del elemento de la lista desplegable
                var rolSeleccionado = comboBox.options[comboBox.selectedIndex].value;

                // Realiza una solicitud fetch para enviar los datos a Consultas.php
                fetch('CrearCuenta.php', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                    },
                    // Envía el valor seleccionado en lugar del elemento de la lista desplegable
                    body: 'correo=' + correo + '&contrasena=' + contrasena + '&comboBox=' + rolSeleccionado
                })
                .then(response => response.json())
                .then(data => {
                    console.log(data); // Maneja la respuesta del servidor
                    if(data['mensaje'] === "Datos guardados en la base de datos"){
                        var enlaceEspecifico = 'Interfaz_Central.html';

                                        // Accede a la ventana principal desde la ventana secundaria
                                var ventanaPrincipal = window.opener;

                            // Cambia la ubicación de la ventana principal
                            if (ventanaPrincipal) {
                                ventanaPrincipal.location.href = enlaceEspecifico;
                                // Cierra la ventana secundaria (ventana de inicio de sesión)
                                window.close();
                            } else {
                                // Si window.opener es nulo, puedes abrir una nueva ventana si es necesario
                                window.open(enlaceEspecifico, '_blank');
                            }
                    }
                    // Aquí puedes realizar acciones dependiendo de la respuesta del servidor
                })
                .catch(error => console.error('Error al realizar la solicitud:', error));
            }
}


    </script>
</body>
</html>
